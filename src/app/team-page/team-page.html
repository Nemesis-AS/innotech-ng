<div
  class="min-h-screen bg-gradient-to-br from-slate-900 via-gray-900 to-black text-gray-100 p-4 sm:p-6 md:p-10"
>
  <div class="max-w-5xl mx-auto p-6 sm:p-8 md:p-10 glass-container">
    <h2
      class="text-2xl sm:text-3xl md:text-4xl font-extrabold mb-8 sm:mb-10 text-center text-indigo-300 tracking-tight"
    >
      ğŸš€ Create Your Team
    </h2>

    <!-- âœ… FORM -->
    @if (!previewMode) {
    <form [formGroup]="makeTeamForm" class="space-y-8 sm:space-y-10">
      <!-- ğŸ· Team Info -->
      <div class="glass-section">
        <h3 class="section-title">ğŸ“› Team Information</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="label">Team Name</label>
            <input
              pInputText
              formControlName="team_name"
              placeholder="âœ¨ Enter a creative team name"
              class="w-full"
            />
          </div>

          <div>
            <label class="label">Department</label>
            <input
              pInputText
              [value]="leader.branch"
              disabled
              class="w-full opacity-70 cursor-not-allowed"
            />
          </div>
        </div>
      </div>

      <!-- ğŸ“‚ Project Details -->
      <div class="glass-section">
        <h3 class="section-title">ğŸ“‚ Project Details</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="label">Select Category</label>
            <p-select
              formControlName="category_id"
              [options]="categories"
              optionLabel="name"
              optionValue="id"
              placeholder="-- Choose a Category --"
              class="w-full"
              (onChange)="onCategoryChange()"
            >
            </p-select>
          </div>

          <div>
            <label class="label">Problem Statement</label>
            <p-select
              formControlName="problem_statement"
              [options]="selectedProblems"
              placeholder="-- Choose a Problem Statement --"
              class="w-full"
            >
            </p-select>
          </div>
        </div>
      </div>

      <!-- ğŸ‘¥ Team Members -->
      <div class="glass-section">
        <h3 class="section-title">ğŸ‘¥ Team Members</h3>

        <ul class="space-y-3 mb-6">
          @for (m of members; track $index) {
          <li class="member-card flex-col sm:flex-row items-start sm:items-center">
            <div class="mb-2 sm:mb-0">
              <span class="font-semibold">{{ m.name }}</span>
              <span class="text-gray-400 text-sm block sm:inline"
                >({{ m.rollnumber }}) - {{ m.branch }}</span
              >
              @if ($index === 0) {
              <span
                class="ml-0 sm:ml-2 px-2 py-1 text-xs bg-yellow-500/20 text-yellow-400 rounded-full inline-block mt-1 sm:mt-0"
                >â­ Leader</span
              >
              }
            </div>
            @if ($index !== 0) {
            <button
              pButton
              type="button"
              class="p-button-danger p-button-rounded p-button-sm self-end sm:self-center"
              (click)="removeMember($index)"
            >Remove</button>
            }
          </li>
          }
        </ul>

        <div class="flex flex-col sm:flex-row gap-3">
          <input
            pInputText
            #rollInput
            placeholder="ğŸ” Enter roll number to add member"
            class="flex-1"
          />
          <p-button
            type="button"
            label="+ Add Member"
            class="w-full"
            (onClick)="addMemberByRoll(rollInput.value)"
            />
            <!-- class="p-button-success" -->
        </div>

        @if (errorMsg) {
        <div class="text-red-400 mt-3 text-sm flex items-center gap-2">âŒ {{ errorMsg }}</div>
        }
      </div>

      <!-- ğŸ“œ Rules & Guidelines -->
      <div class="glass-section border-l-4 border-yellow-500">
        <h3 class="section-title text-yellow-400">ğŸ“œ Rules & Guidelines</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-300 text-sm sm:text-base">
          <li>âœ… A team comprises of <strong>2 to 5 members</strong>.</li>
          <li>ğŸ¤ Members <strong>can be from different courses and branches</strong>.</li>
          <li>ğŸ“‚ A team <strong>can register for only one category</strong>.</li>
          <li>ğŸš« A participant <strong>can be part of only one team</strong>.</li>
          <li>ğŸ”’ Once registered, <strong>no modification</strong> is allowed.</li>
          <li>
            âš  If any member <strong>withdraws</strong>, the
            <strong>team will be disqualified</strong>.
          </li>
          <li>ğŸ’¸ There is <strong>no registration fee</strong>.</li>
          <li>ğŸ“‰ <strong>No reimbursement</strong> for project expenses.</li>
        </ul>

        <div class="mt-6 flex items-start gap-3">
          <p-checkbox formControlName="acknowledged" binary="true"></p-checkbox>
          <span class="text-xs sm:text-sm text-gray-300"
            >I have read and understood all the rules and agree to abide by them.</span
          >
        </div>
        @if (makeTeamForm.get('acknowledged')?.invalid && submittedForm) {
        <div class="text-red-400 text-sm mt-2">âš  You must accept the rules before submitting.</div>
        }
      </div>

      <!-- ğŸ“¤ Submit -->
      <div class="text-center pt-6">
        <p-button
          type="button"
          label="Preview & Submit"
          [disabled]="makeTeamForm.invalid"
          (onClick)="previewTeam()"
        ></p-button>
      </div>
    </form>
    }

    <!-- ğŸ“„ Preview Mode -->
    @if (previewMode) {
    <div class="animate-fadeIn">
      <h3 class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-center text-indigo-300 mb-6 sm:mb-8">
        ğŸ“„ Team Preview
      </h3>

      <div class="glass-section max-w-2xl mx-auto text-sm sm:text-base">
        <p><strong>Team Name:</strong> {{ makeTeamForm.value.team_name }}</p>
        <p><strong>Category:</strong> {{ selectedCategoryName }}</p>
        <p><strong>Problem Statement:</strong> {{ makeTeamForm.value.problem_statement }}</p>
        <p><strong>Department:</strong> {{ leader.branch }}</p>

        <h4 class="mt-6 text-lg sm:text-xl font-bold text-indigo-300">ğŸ‘¥ Members</h4>
        <ul class="mt-3 space-y-1">
          @for (m of members; track $index) {
          <li>
            âœ… {{ m.name }} ({{ m.rollnumber }}) - {{ m.branch }}
            @if (m.firebase_uid === leader.firebase_uid) {
            <span class="text-yellow-400">â­ Leader</span>
            }
          </li>
          }
        </ul>
      </div>

      <div class="mt-8 flex flex-col sm:flex-row justify-center gap-4 sm:gap-6">
        <p-button
          pButton
          label="â† Back"
          class="p-button-secondary w-full sm:w-auto"
          (onClick)="previewMode = false"
        />
        <p-button label="Submit Team" class="w-full sm:w-auto" (onClick)="submitTeam()" />
      </div>
    </div>
    }
  </div>
</div>
